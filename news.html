<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ø£Ø®Ø¨Ø§Ø± ÙˆÙ…Ø³ØªØ¬Ø¯Ø§Øª Ø¹Ø§Ø¦Ù„Ø© Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·">
    <meta name="theme-color" content="#D4AF37">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·">

    <title>Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/style.css">

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- OneSignal Push Notifications -->
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
    <script>
        window.OneSignalDeferred = window.OneSignalDeferred || [];
        OneSignalDeferred.push(async function (OneSignal) {
            await OneSignal.init({
                appId: "33461894-4470-4dd2-b2c3-222591f4ca88",
                safari_web_id: "web.onesignal.auto.33461894-4470-4dd2-b2c3-222591f4ca88"
            });
        });
    </script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">Ù…</div>
            <div class="header-title">
                <h1>Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</h1>
                <p>Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø±</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- News Section -->
        <section class="section">
            <div class="section-title">
                <span class="icon">ğŸ“°</span>
                <h2>Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2>
            </div>

            <div class="news-grid" id="newsGrid">
                <!-- Loading State -->
                <div class="loading" id="loadingState">
                    <div class="spinner"></div>
                </div>

                <!-- Empty State (hidden by default) -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="icon">ğŸ“°</div>
                    <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                    <p>Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-item">
                <span class="icon">ğŸ’</span>
                <span>Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</span>
            </a>
            <a href="news.html" class="nav-item active">
                <span class="icon">ğŸ“°</span>
                <span>Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span>
            </a>
            <a href="admin.html" class="nav-item">
                <span class="icon">âš™ï¸</span>
                <span>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</span>
            </a>
        </div>
    </nav>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="js/supabase.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }

        // Load news on page load
        document.addEventListener('DOMContentLoaded', loadNews);

        async function loadNews() {
            const grid = document.getElementById('newsGrid');
            const loading = document.getElementById('loadingState');
            const empty = document.getElementById('emptyState');

            try {
                const news = await getNews();
                loading.style.display = 'none';

                if (news.length === 0) {
                    empty.style.display = 'block';
                    return;
                }

                grid.innerHTML = news.map(item => createNewsCard(item)).join('');
            } catch (error) {
                loading.style.display = 'none';
                grid.innerHTML = `
          <div class="empty-state">
            <div class="icon">âš ï¸</div>
            <h3>Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
            <p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</p>
          </div>
        `;
            }
        }

        function createNewsCard(item) {
            const date = new Date(item.created_at);
            const formattedDate = date.toLocaleDateString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            return `
        <article class="news-card">
          ${item.image_url ? `<img src="${item.image_url}" alt="${item.title}" class="news-image">` : ''}
          <h3>${item.title}</h3>
          <p>${item.content || ''}</p>
          <div class="news-date">
            <span>ğŸ“…</span>
            <span>${formattedDate}</span>
          </div>
          ${item.url ? `
            <a href="${item.url}" target="_blank" class="btn btn-secondary btn-link" style="margin-top: 1rem;">
              <span>ğŸ”—</span>
              <span>Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯</span>
            </a>
          ` : ''}
        </article>
      `;
        }
    </script>
</body>

</html>